<main>
  <section class="column align-center">
    <app-header *ngIf="this.navigationService.isMobile"></app-header>
    <div class="headline">
      <div>
        <img src="/img/workspace-logo.svg" alt="" />
        <h1>Devspace</h1>
      </div>
      <button (click)="this.navigationService.showNewMessage(); this.userService.setUrl('newMessage')">
        <mat-icon class="material-symbols-outlined">edit_square</mat-icon>
      </button>
    </div>

    @if (isClicked) {
    <div class="justify-sb full-width p-lr-16">
      <h2>Search</h2>
      <button (click)="isClicked = false; resetSearch(); resetInput()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    } @if(this.navigationService.isMobile){
    <div class="searchbar">
      <div class="input" *ngIf="!userService.login && userService.dashboard">
        <input
          (click)="isClicked = true; input = '@'"
          [(ngModel)]="input"
          (input)="getList()"
          type="text"
          placeholder="Gehe zu ..."
          class="full-width"
        />
        <mat-icon>search</mat-icon>
      </div>

      @if (currentlist.length>0 && input.trim().length >0 && (input[0]== "#" || input[0] =="@")) {
      <ul class="lists">
        @for (object of currentlist; track $index;) {
        <li (click)="getReciever(object.id)" [ngClass]="{ channelStyle: isChannel }" class="listrow">
          @if (!isChannel) {
          <div class="imageContainer">
            <img [src]="object?.profilephoto" alt="" />
            <div class="status-dot" [ngClass]="{ green: object?.online }"></div>
          </div>
          }@else { <img class="tag" src="./img/tag.svg" alt="" />}
          <span>{{ object?.fullname || object?.name }}</span>
          @if (object?.fullname === currentUser?.displayName) {
          <span>(Du)</span>
          }
        </li>
        }
      </ul>
      }
    </div>

    } @if (!isClicked) {
    <div class="contactbar">
      <div class="channels">
        <div class="drop-down-title">
          <button class="d-flex align-center gap-10" (click)="toggleActive()">
            <mat-icon class="material-symbols-outlined" [ngClass]="{ rotate: isActive() }"> arrow_drop_down</mat-icon>
            <mat-icon class="material-symbols-outlined">workspaces</mat-icon>
            Channels
          </button>
          <button title="Zugang für Gäste gespeert" class="align-center" [ngClass]="{ 'guest-btn': currentUser.isAnonymous }" [disabled]="currentUser.isAnonymous" (click)="openAddChannel()">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <ul [ngClass]="{ show: isActive() }" class="channellist">
          @for (channel of channels; track $index; let index = $index) {
          <li
            [ngClass]="{ 'active-link': currentLink === channel.name }"
            class="li"
            (click)="
              openWindow('channel', channel.name); this.userService.setUrl('channel', channel.id, this.userService.auth.currentUser?.uid)
            "
          >
            <mat-icon class="material-symbols-outlined">tag</mat-icon>
            <span>{{ channel.name }}</span>
          </li>
          } @empty {No Channel found}
        </ul>
      </div>

      <button title="Zugang für Gäste gespeert" [disabled]="currentUser.isAnonymous" class="addChannel" [ngClass]="{ 'guest-btn': currentUser.isAnonymous }" (click)="openAddChannel()">
        <mat-icon class="material-symbols-outlined">add_circle</mat-icon>
        Channel hinzufügen
      </button>

      <div class="messages">
        <div class="drop-down-title">
          <button class="d-flex align-center gap-10" (click)="toggleMessage()">
            <mat-icon class="material-symbols-outlined" [ngClass]="{ rotate: isOpen() }"> arrow_drop_down</mat-icon>
            <mat-icon class="material-symbols-outlined">account_circle</mat-icon>
            Direktnachrichten
          </button>
        </div>

        <ul [ngClass]="{ show: isOpen() }" class="contacts">
          @for (user of users; track $index; let index = $index) {
          <li
            [ngClass]="{ 'active-link': currentLink === user.fullname }"
            (click)="
              openWindow('direct', user.fullname); this.userService.setUrl('direct', user.id, this.userService.auth.currentUser?.uid)
            "
            class="li"
          >
            <div class="imageContainer">
              <img class="profile-image" [src]="user.profilephoto" alt="" />
              <div class="status-dot" [ngClass]="{ green: user.online }"></div>
            </div>

            <span>{{ user.fullname }}</span>
          </li>
          }@empty {No User found}
        </ul>
      </div>
    </div>
    }
  </section>

  <button class="add-message-btn-mobile" (click)="this.navigationService.showNewMessage(); this.userService.setUrl('newMessage')">
    <mat-icon class="material-symbols-outlined">edit_square</mat-icon>
  </button>
</main>
